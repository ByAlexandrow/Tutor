{% extends "base.html" %}
{% load static %}

{% block title %}{{ post.title }} | Репетитор по русскому языку онлайн{% endblock %}

{% block content %}
<article class="single-post-page">
    <div class="container">
        <!-- Заголовок поста -->
        <header class="post-header">
            <div class="post-meta">
                <span class="post-date">{{ post.date|date:"d F Y" }}</span>
                {% if post.tag %}
                <span class="post-category">{{ post.tag.title }}</span>
                {% endif %}
            </div>
            <h1 class="post-title">{{ post.title }}</h1>
        </header>
        <!-- Изображение поста -->
        {% if post.img %}
        <div class="post-featured-image">
            <img src="{{ post.img.url }}" alt="{{ post.title }}" class="post-image">
            {% if post.img_caption %}
            <div class="image-caption">{{ post.img_caption }}</div>
            {% endif %}
        </div>
        {% endif %}
        <!-- Основной контент -->
        <div class="post-content">
            {{ post.content|safe }}
        </div>
    </div>
</article>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Копирование ссылки
    const copyButton = document.querySelector('.copy-link');
    if (copyButton) {
        copyButton.addEventListener('click', function() {
            const url = window.location.href;
            
            navigator.clipboard.writeText(url)
                .then(() => {
                    // Временно меняем иконку на галочку
                    const originalHTML = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-check"></i>';
                    this.style.backgroundColor = '#10b981';
                    
                    setTimeout(() => {
                        this.innerHTML = originalHTML;
                        this.style.backgroundColor = '';
                    }, 2000);
                })
                .catch(err => {
                    console.error('Ошибка копирования:', err);
                });
        });
    }
    
    // Лайк поста
    const likeButton = document.getElementById('like-button');
    if (likeButton) {
        likeButton.addEventListener('click', function() {
            const likeCount = document.getElementById('like-count');
            const currentCount = parseInt(likeCount.textContent);
            const isLiked = this.classList.contains('active');
            
            // Визуальная обратная связь
            if (!isLiked) {
                this.classList.add('active');
                likeCount.textContent = currentCount + 1;
                this.innerHTML = '<i class="fas fa-heart"></i> ' + (currentCount + 1);
            } else {
                this.classList.remove('active');
                likeCount.textContent = currentCount - 1;
                this.innerHTML = '<i class="far fa-heart"></i> ' + (currentCount - 1);
            }
            
            // Отправка на сервер (заглушка)
            // В реальном проекте здесь должен быть fetch запрос
            console.log('Like action:', !isLiked ? 'liked' : 'unliked');
        });
    }
    
    // Сохранение в закладки
    const bookmarkButton = document.querySelector('.btn-bookmark');
    if (bookmarkButton) {
        bookmarkButton.addEventListener('click', function() {
            const isBookmarked = this.classList.contains('active');
            
            if (!isBookmarked) {
                this.classList.add('active');
                this.innerHTML = '<i class="fas fa-bookmark"></i> Сохранено';
            } else {
                this.classList.remove('active');
                this.innerHTML = '<i class="far fa-bookmark"></i> Сохранить';
            }
            
            // Отправка на сервер (заглушка)
            console.log('Bookmark action:', !isBookmarked ? 'bookmarked' : 'unbookmarked');
        });
    }
    
    // Плавная прокрутка для якорей внутри статьи
    document.querySelectorAll('.post-content a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            const targetId = this.getAttribute('href');
            if (targetId !== '#') {
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    e.preventDefault();
                    targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }
        });
    });
});
</script>
{% endblock %}